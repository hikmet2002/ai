let recognition;
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

if (SpeechRecognition) {
  recognition = new SpeechRecognition();
  recognition.lang = 'ru-RU';
  recognition.continuous = true; // Микрофон работает всегда
  recognition.interimResults = false;

  recognition.onresult = function(event) {
    const transcript = event.results[event.results.length - 1][0].transcript.trim();
    appendOutput("Вы сказали: " + transcript);
  };

  recognition.onerror = function(event) {
    console.error("Ошибка распознавания:", event.error);
    if (event.error === 'not-allowed') {
      appendOutput("Ошибка: доступ к микрофону запрещён.");
      document.getElementById('status').textContent = "Ошибка микрофона";
      document.getElementById('status').style.color = "red";
    }
  };

  recognition.onend = function() {
    console.log("Распознавание завершилось, перезапускаем...");
    setTimeout(() => recognition.start(), 1000); // Автоматический перезапуск
  };

  // Функция запуска микрофона один раз
  function startMic() {
    try {
      recognition.start();
      appendOutput("Микрофон активен.");
    } catch (error) {
      appendOutput("Ошибка при запуске микрофона: " + error.message);
    }
  }

  startMic(); // Запускаем микрофон при загрузке страницы
} else {
  appendOutput("Ваш браузер не поддерживает голосовое распознавание.");
}

function appendOutput(text) {
  const output = document.getElementById('output');
  output.innerHTML += `<p>${text}</p>`;
  output.scrollTop = output.scrollHeight;
}
